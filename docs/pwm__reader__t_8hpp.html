<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>eRumby-Firmware: pwm_reader_t.hpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="header.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">eRumby-Firmware
   &#160;<span id="projectnumber">1.0.0-beta</span>
   </div>
   <div id="projectbrief">Firmware for the eRumby low level microcontroller</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a>  </div>
  <div class="headertitle">
<div class="title">pwm_reader_t.hpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;Arduino.h&gt;</code><br />
<code>#include &quot;<a class="el" href="configurations_8hpp_source.html">configurations.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="types_8hpp_source.html">types.hpp</a>&quot;</code><br />
</div>
<p><a href="pwm__reader__t_8hpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpwm__reader__t.html">pwm_reader_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Class for reading non attachable pins.  <a href="classpwm__reader__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpwm__reader__attachable__t.html">pwm_reader_attachable_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Class for an attachable pin that reads PWM.  <a href="classpwm__reader__attachable__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:aade324dde8d853b82af03b27c9ee7afa"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pwm__reader__t_8hpp.html#aade324dde8d853b82af03b27c9ee7afa">DUTY_MODE_DELTA</a>&#160;&#160;&#160;500</td></tr>
<tr class="separator:aade324dde8d853b82af03b27c9ee7afa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a730ae25deaea095f8b02bdbdd2baac93"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pwm__reader__t_8hpp.html#a730ae25deaea095f8b02bdbdd2baac93">DUTY_MODE_STABILIZER</a>&#160;&#160;&#160;10</td></tr>
<tr class="separator:a730ae25deaea095f8b02bdbdd2baac93"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a9d58be16c7d46826ab3b7d6372ea9991"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pwm__reader__t_8hpp.html#a9d58be16c7d46826ab3b7d6372ea9991">pwm_attachable_callback_t</a>) (void)</td></tr>
<tr class="separator:a9d58be16c7d46826ab3b7d6372ea9991"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a136146aa7bb5caca5374e70d4792a93c"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="types_8hpp.html#aede467d93ddeb5fdeff6023236aa4ad6">pin_t</a>(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pwm__reader__t_8hpp.html#a136146aa7bb5caca5374e70d4792a93c">pwm_port_reader_t</a>) (void)</td></tr>
<tr class="separator:a136146aa7bb5caca5374e70d4792a93c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Matteo Ragni</dd></dl>
<p>This file contains two helper classes that allows to easily read the pwm signal on a pin. To to some peculiarities this class is taylored made for the Arduino Mega 2560 which is on the erumby car, but it is quite easy to generalize it for different boards, using the same approach.</p>
<p>There are two classes of pins which are considered:</p><ul>
<li>pins for which the <code>attachInterrupt</code> function can be used, which are handled by <code><a class="el" href="classpwm__reader__attachable__t.html" title="Class for an attachable pin that reads PWM. ">pwm_reader_attachable_t</a></code> and have a digital read</li>
<li>pins for which we must configure the registers to intercept the interrupts, which are handled by <code><a class="el" href="classpwm__reader__t.html" title="Class for reading non attachable pins. ">pwm_reader_t</a></code> </li>
</ul>
<p>The implementation is made in a way that for the user the declaration of a pwm input pin as simple as possible. For example: </p><div class="fragment"><div class="line"><a class="code" href="classpwm__reader__t.html">pwm_reader_t</a> pwm = <a class="code" href="classpwm__reader__t.html">pwm_reader_t</a>(52); <span class="comment">// Attach to pin 52</span></div><div class="line"></div><div class="line"><span class="comment">// to get the current read</span></div><div class="line">pwm.<a class="code" href="classpwm__reader__t.html#a493b4957f4088e806295d07d14948504">get_pulse</a>();</div></div><!-- fragment --><p>For the specific board considered:</p><ul>
<li>attachable pins: 2, 3, 18, 19, 20, 21 (no more can be added)</li>
<li>non-attachable pin: 52, 53, A8, A9 (more can be implemented)</li>
</ul>
<p>The non attachable interrupt are particularly troublesome, because it is necessary to set up the registers. For each pin it is necessary to know:</p><ul>
<li>the belonging port (e.g. 52 and 53 are in PORT_B, A8 and A9 in PORT_K)</li>
<li>the position on the port (also known as mask, a 8-bit value)</li>
</ul>
<p>The algorithm for reading the pulse is quite simple, and it is performed in an interrupt routine: </p><div class="fragment"><div class="line">read the value of the pin</div><div class="line"><span class="keywordflow">if</span> the pin is high</div><div class="line">  store the current <span class="keyword">raise</span> time</div><div class="line"><span class="keywordflow">else</span></div><div class="line">  evaluate the pulse time</div></div><!-- fragment --><p> The classes have also a counter and a stabilized pulse value for some specific applications. </p>

<p class="definition">Definition in file <a class="el" href="pwm__reader__t_8hpp_source.html">pwm_reader_t.hpp</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="aade324dde8d853b82af03b27c9ee7afa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aade324dde8d853b82af03b27c9ee7afa">&#9670;&nbsp;</a></span>DUTY_MODE_DELTA</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DUTY_MODE_DELTA&#160;&#160;&#160;500</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>A delta for reading the mode (erumby remote specific) </p>

<p class="definition">Definition at line <a class="el" href="pwm__reader__t_8hpp_source.html#l00056">56</a> of file <a class="el" href="pwm__reader__t_8hpp_source.html">pwm_reader_t.hpp</a>.</p>

</div>
</div>
<a id="a730ae25deaea095f8b02bdbdd2baac93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a730ae25deaea095f8b02bdbdd2baac93">&#9670;&nbsp;</a></span>DUTY_MODE_STABILIZER</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DUTY_MODE_STABILIZER&#160;&#160;&#160;10</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Number of read for stabilization </p>

<p class="definition">Definition at line <a class="el" href="pwm__reader__t_8hpp_source.html#l00057">57</a> of file <a class="el" href="pwm__reader__t_8hpp_source.html">pwm_reader_t.hpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="a9d58be16c7d46826ab3b7d6372ea9991"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d58be16c7d46826ab3b7d6372ea9991">&#9670;&nbsp;</a></span>pwm_attachable_callback_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* pwm_attachable_callback_t) (void)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Callback type for attachable pins </p>

<p class="definition">Definition at line <a class="el" href="pwm__reader__t_8hpp_source.html#l00058">58</a> of file <a class="el" href="pwm__reader__t_8hpp_source.html">pwm_reader_t.hpp</a>.</p>

</div>
</div>
<a id="a136146aa7bb5caca5374e70d4792a93c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a136146aa7bb5caca5374e70d4792a93c">&#9670;&nbsp;</a></span>pwm_port_reader_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="types_8hpp.html#aede467d93ddeb5fdeff6023236aa4ad6">pin_t</a>(* pwm_port_reader_t) (void)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Callback for non attachable pins </p>

<p class="definition">Definition at line <a class="el" href="pwm__reader__t_8hpp_source.html#l00059">59</a> of file <a class="el" href="pwm__reader__t_8hpp_source.html">pwm_reader_t.hpp</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Nov 14 2018 15:36:00 for eRumby-Firmware by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
